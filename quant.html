<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Quantitative Risk and Asset Management</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="quant_files/libs/clipboard/clipboard.min.js"></script>
<script src="quant_files/libs/quarto-html/quarto.js"></script>
<script src="quant_files/libs/quarto-html/popper.min.js"></script>
<script src="quant_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="quant_files/libs/quarto-html/anchor.min.js"></script>
<link href="quant_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="quant_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="quant_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="quant_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="quant_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#outline" id="toc-outline" class="nav-link active" data-scroll-target="#outline">Outline</a></li>
  <li><a href="#question-1" id="toc-question-1" class="nav-link" data-scroll-target="#question-1">Question 1</a>
  <ul class="collapse">
  <li><a href="#on-average-do-more-volatile-industries-have-higher-average-log-returns-and-higher-average-returns" id="toc-on-average-do-more-volatile-industries-have-higher-average-log-returns-and-higher-average-returns" class="nav-link" data-scroll-target="#on-average-do-more-volatile-industries-have-higher-average-log-returns-and-higher-average-returns">1.1: On average, do more volatile industries have higher average log returns? And higher average returns?</a></li>
  </ul></li>
  <li><a href="#question-2" id="toc-question-2" class="nav-link" data-scroll-target="#question-2">Question 2</a>
  <ul class="collapse">
  <li><a href="#plot-the-cumulative-log-returns-for-an-equal-weighted-portfolio-each-industry-with-weight-117.-compute-mean-std-and-sharpe-ratio-for-returns." id="toc-plot-the-cumulative-log-returns-for-an-equal-weighted-portfolio-each-industry-with-weight-117.-compute-mean-std-and-sharpe-ratio-for-returns." class="nav-link" data-scroll-target="#plot-the-cumulative-log-returns-for-an-equal-weighted-portfolio-each-industry-with-weight-117.-compute-mean-std-and-sharpe-ratio-for-returns.">2.1 - Plot the Cumulative log returns for an equal-weighted portfolio (each industry with weight 1/17). Compute mean, std, and Sharpe ratio for returns.</a></li>
  <li><a href="#question-2.2---repeat-2.1-but-now-weight-each-industry-by-the-inverse-of-its-full-sample-standard-deviation-with-weights-normalized-so-they-sum-up-to-one." id="toc-question-2.2---repeat-2.1-but-now-weight-each-industry-by-the-inverse-of-its-full-sample-standard-deviation-with-weights-normalized-so-they-sum-up-to-one." class="nav-link" data-scroll-target="#question-2.2---repeat-2.1-but-now-weight-each-industry-by-the-inverse-of-its-full-sample-standard-deviation-with-weights-normalized-so-they-sum-up-to-one.">Question 2.2 - Repeat 2.1, but now weight each industry by the inverse of its full-sample standard deviation, with weights normalized so they sum up to one.</a></li>
  <li><a href="#question-2.3---repeat-1-but-now-each-month-select-the-6-industries-each-allocated-16-of-capital-with-the-highest-return-in-the-past-12-months-computed-as-pit-pit-250---1." id="toc-question-2.3---repeat-1-but-now-each-month-select-the-6-industries-each-allocated-16-of-capital-with-the-highest-return-in-the-past-12-months-computed-as-pit-pit-250---1." class="nav-link" data-scroll-target="#question-2.3---repeat-1-but-now-each-month-select-the-6-industries-each-allocated-16-of-capital-with-the-highest-return-in-the-past-12-months-computed-as-pit-pit-250---1.">Question 2.3 - Repeat (1), but now each month select the 6 industries (each allocated 1/6 of capital) with the highest return in the past 12 months (computed as<span class="math inline">\([ P(i;t) / P(i;t-250) ] - 1)\)</span>.</a></li>
  </ul></li>
  <li><a href="#question-3" id="toc-question-3" class="nav-link" data-scroll-target="#question-3">Question 3</a>
  <ul class="collapse">
  <li><a href="#repeat-the-momentum-strategy-of-question-2.3-but-instead-of-a-constant-full-allocation-of-capital-in-each-period-day-compute-the-covariance-matrix-between-the-6-chosen-industry-in-the-previous-3-months-63-trading-days-and-use-it-to-target-a-constant-portfolio-standard-deviation-of-20-annually." id="toc-repeat-the-momentum-strategy-of-question-2.3-but-instead-of-a-constant-full-allocation-of-capital-in-each-period-day-compute-the-covariance-matrix-between-the-6-chosen-industry-in-the-previous-3-months-63-trading-days-and-use-it-to-target-a-constant-portfolio-standard-deviation-of-20-annually." class="nav-link" data-scroll-target="#repeat-the-momentum-strategy-of-question-2.3-but-instead-of-a-constant-full-allocation-of-capital-in-each-period-day-compute-the-covariance-matrix-between-the-6-chosen-industry-in-the-previous-3-months-63-trading-days-and-use-it-to-target-a-constant-portfolio-standard-deviation-of-20-annually.">3.3 - Repeat the momentum strategy of Question 2.3, but instead of a constant, full allocation of capital, in each period (day), compute the covariance matrix between the 6 chosen industry in the previous 3 months (63 trading days), and use it to target a constant portfolio standard deviation of 20% annually.</a></li>
  </ul></li>
  <li><a href="#question-4" id="toc-question-4" class="nav-link" data-scroll-target="#question-4">Question 4</a>
  <ul class="collapse">
  <li><a href="#compute-the-equal-weighted-portfolio-as-in-question-2.1-on-the-1960-2022-sample-and-the-yearly-return-in-each-industry-as-in-question-2.3.-in-each-period-each-day-compute-the-share-alpha_t-of-industries-with-positive-momentum-positive-yearly-return-and-invest-in-the-equal-weighted-portfolio-each-month-a-share-alpha_t-with-the-rest-going-to-cash-which-you-should-assume-yields-3-annually" id="toc-compute-the-equal-weighted-portfolio-as-in-question-2.1-on-the-1960-2022-sample-and-the-yearly-return-in-each-industry-as-in-question-2.3.-in-each-period-each-day-compute-the-share-alpha_t-of-industries-with-positive-momentum-positive-yearly-return-and-invest-in-the-equal-weighted-portfolio-each-month-a-share-alpha_t-with-the-rest-going-to-cash-which-you-should-assume-yields-3-annually" class="nav-link" data-scroll-target="#compute-the-equal-weighted-portfolio-as-in-question-2.1-on-the-1960-2022-sample-and-the-yearly-return-in-each-industry-as-in-question-2.3.-in-each-period-each-day-compute-the-share-alpha_t-of-industries-with-positive-momentum-positive-yearly-return-and-invest-in-the-equal-weighted-portfolio-each-month-a-share-alpha_t-with-the-rest-going-to-cash-which-you-should-assume-yields-3-annually">4.1 - Compute the equal-weighted portfolio as in Question 2.1 (on the 1960-2022 sample) and the yearly return in each industry as in Question 2.3. In each period (each day), compute the share alpha_t of industries with positive momentum (positive yearly return), and invest in the equal-weighted portfolio each month a share alpha_t, with the rest going to cash, which you should assume yields 3% annually</a></li>
  </ul></li>
  <li><a href="#question-5" id="toc-question-5" class="nav-link" data-scroll-target="#question-5">Question 5</a>
  <ul class="collapse">
  <li><a href="#for-the-full-sample-repeat-the-momentum-strategy-in-question-2.3-but-use-the-returns-of-the-previous-five-years-252-5-days-as-a-measure-of-momentum.-briefly-comment-on-the-results." id="toc-for-the-full-sample-repeat-the-momentum-strategy-in-question-2.3-but-use-the-returns-of-the-previous-five-years-252-5-days-as-a-measure-of-momentum.-briefly-comment-on-the-results." class="nav-link" data-scroll-target="#for-the-full-sample-repeat-the-momentum-strategy-in-question-2.3-but-use-the-returns-of-the-previous-five-years-252-5-days-as-a-measure-of-momentum.-briefly-comment-on-the-results.">5.1 - For the full sample, repeat the momentum strategy in Question 2.3, but use the returns of the previous five years (252 * 5 days) as a measure of momentum. Briefly comment on the results.</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Quantitative Risk and Asset Management</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="outline" class="level2">
<h2 class="anchored" data-anchor-id="outline">Outline</h2>
<p>This is a mandatory assignment for a course <em>Quantitative Risk and Asset Management</em> handed in 2022 at Oslo BI Norwegian Business School, transformed into a readable notebook form.</p>
<p>The data used has daily returns for 17 US industries (from the Kenneth French database, value weighted) from 1926 to 2022.</p>
<div class="cell" data-hash="quant_cache/html/unnamed-chunk-2_307cf7d8c895275bd2224644ed88dcee">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/Users/aleksi/BI Quantitative Risk and Asset Management/Industry17PortfoliosDaily.csv"</span>, <span class="at">skip =</span> <span class="dv">9</span>, <span class="at">header =</span> T)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         X  Food Mines   Oil Clths Durbl Chems Cnsum Cnstr Steel FabPr Machn
1 19260701  0.03  0.30  0.62  0.14 -1.09  0.56  0.04  0.30 -0.62 -0.79 -0.12
2 19260702  0.11  0.36  0.71 -0.16 -0.57  1.01  0.60 -0.03  1.18  0.96  0.38
3 19260706  0.05 -0.19  0.17  0.37 -1.90  0.21  0.47  0.38  0.17  0.68  0.51
4 19260707  0.54 -0.17 -0.03  0.18 -0.06  0.83 -0.12 -0.10 -0.03  2.36 -0.12
5 19260708  0.94  0.34  0.09  0.75 -0.28 -0.14  0.42  0.35 -0.07 -0.50  0.48
6 19260709 -0.41 -0.57 -1.65 -0.09 -1.33 -1.61 -0.45 -0.72 -0.99 -2.08 -0.67
   Cars Trans Utils Rtail Finan Other
1 -0.15  0.08  0.61 -0.01  0.58 -0.01
2  1.09  0.05  0.47  0.01 -0.16  0.38
3  0.88 -0.16  0.73 -0.23  0.20  0.16
4  0.04  0.12  0.17 -0.58 -0.07  0.42
5  0.01  0.46 -0.20 -0.36 -0.48  0.49
6 -1.09 -0.31 -0.74  0.41 -0.03 -0.16</code></pre>
</div>
</div>
</section>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<section id="on-average-do-more-volatile-industries-have-higher-average-log-returns-and-higher-average-returns" class="level3">
<h3 class="anchored" data-anchor-id="on-average-do-more-volatile-industries-have-higher-average-log-returns-and-higher-average-returns">1.1: On average, do more volatile industries have higher average log returns? And higher average returns?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting the data from 1960 to 2022 from the full dataset</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data60<span class="fl">.22</span> <span class="ot">&lt;-</span> data[data[, <span class="dv">1</span>] <span class="sc">&gt;</span> <span class="st">"1960-01-01"</span>, ] </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the log of the 1960-2022 dataset</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>log.data.<span class="fl">60.22</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data60<span class="fl">.22</span><span class="sc">$</span>date, <span class="fu">log</span>(data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>) )</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Average annualized returns for every industry</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>avg.ret60<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>] ) <span class="sc">*</span> <span class="dv">252</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Annualized Volatility (standard deviation) for every industry</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>industry.std60<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fu">apply</span>(data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, sd) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">252</span>) </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining Log returns for every industry, daily basis</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>log.ret60<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fu">apply</span>((data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>), <span class="dv">2</span>, log) <span class="co"># + 1 to compute log returns</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking for NaNs and infinite values in the log returns:</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">is.infinite</span>(log.ret60<span class="fl">.22</span>)) <span class="co"># no infinite values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>integer(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">is.nan</span>(log.ret60<span class="fl">.22</span>))      <span class="co"># no NaNs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>integer(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing annualized average log returns for every industry</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>avg.log.ret60<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(log.ret60<span class="fl">.22</span>, <span class="at">na.rm =</span> T) <span class="sc">*</span> <span class="dv">252</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking for non Gaussianity in the data 1960 - 2022</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>skew <span class="ot">&lt;-</span> <span class="fu">apply</span>(data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, skewness ) </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>kurt <span class="ot">&lt;-</span> <span class="fu">apply</span>(data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, kurtosis )</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(kurt) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17.25315</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(kurt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.74064</code></pre>
</div>
</div>
<div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="quant_files/figure-html/plot-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="quant_files/figure-html/plot-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<section id="plot-the-cumulative-log-returns-for-an-equal-weighted-portfolio-each-industry-with-weight-117.-compute-mean-std-and-sharpe-ratio-for-returns." class="level3">
<h3 class="anchored" data-anchor-id="plot-the-cumulative-log-returns-for-an-equal-weighted-portfolio-each-industry-with-weight-117.-compute-mean-std-and-sharpe-ratio-for-returns.">2.1 - Plot the Cumulative log returns for an equal-weighted portfolio (each industry with weight 1/17). Compute mean, std, and Sharpe ratio for returns.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the portfolio average returns over the 1960-2022 period</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>bal.port.weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">17</span>,<span class="dv">17</span>)                                </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>bal.port.ret     <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(bal.port.weights <span class="sc">*</span> data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>]) </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>bal.port.avg.ret <span class="ot">&lt;-</span> <span class="fu">mean</span>(bal.port.ret) <span class="sc">*</span> <span class="dv">252</span>                    </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio standard deviation</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>bal.port.std <span class="ot">&lt;-</span> <span class="fu">sd</span>(bal.port.ret)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">252</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sharpe Ratio</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>bal.port.Sharpe <span class="ot">&lt;-</span> bal.port.avg.ret <span class="sc">/</span> bal.port.std</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the cumulative log returns and then plotting </span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>bal.port.log.ret     <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> bal.port.ret)    </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>bal.port.cum.log.ret <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(bal.port.log.ret) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot 4: Cumulative Log returns of the Equally weighted portfolio </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data60<span class="fl">.22</span><span class="sc">$</span>date)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(bal.port.cum.log.ret)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>M3 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x1, y1)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(M3, <span class="fu">aes</span>(<span class="at">x =</span> data60<span class="fl">.22</span><span class="sc">$</span>date, <span class="at">y =</span> bal.port.cum.log.ret)) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cumulative Log Returns (2.1)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span><span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales <span class="sc">::</span> percent)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="quant_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="question-2.2---repeat-2.1-but-now-weight-each-industry-by-the-inverse-of-its-full-sample-standard-deviation-with-weights-normalized-so-they-sum-up-to-one." class="level3">
<h3 class="anchored" data-anchor-id="question-2.2---repeat-2.1-but-now-weight-each-industry-by-the-inverse-of-its-full-sample-standard-deviation-with-weights-normalized-so-they-sum-up-to-one.">Question 2.2 - Repeat 2.1, but now weight each industry by the inverse of its full-sample standard deviation, with weights normalized so they sum up to one.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the full sample industry annualized standard deviation</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>industry.std.full.sample <span class="ot">&lt;-</span> <span class="fu">apply</span>(data[, <span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, sd) </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalizing the weights to sum up to 1</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>normalizer        <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="fu">sum</span>(industry.std.full.sample))   <span class="co"># normalizing coefficient</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>norm.port.weights <span class="ot">&lt;-</span> industry.std.full.sample <span class="sc">*</span> normalizer <span class="co"># normalized weights</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(norm.port.weights)                                     <span class="co"># they sum up to 1 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(norm.port.weights) <span class="sc">==</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">17</span>                            <span class="co"># equal to 1/17</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Annualized average normalized Portfolio returns, 1960-2022 sample data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>norm.port.ret     <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(norm.port.weights <span class="sc">*</span> data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>norm.port.avg.ret <span class="ot">&lt;-</span> <span class="fu">mean</span>(norm.port.ret) <span class="sc">*</span> <span class="dv">252</span> <span class="co"># norm port returns, annualized</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalized portfolio, annualized standard deviation</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>norm.port.std <span class="ot">&lt;-</span> <span class="fu">sd</span>(norm.port.ret)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">252</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sharpe Ratio</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>norm.port.Sharpe <span class="ot">&lt;-</span> norm.port.avg.ret <span class="sc">/</span> norm.port.std</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting cumulative portfolio log returns </span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>norm.port.log.ret     <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> norm.port.ret)   </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>norm.port.cum.log.ret <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(norm.port.log.ret) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot 5: Cumulative Log returns of the normalized portfolio </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data60<span class="fl">.22</span><span class="sc">$</span>date)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(norm.port.cum.log.ret)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>M4 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x1, y2)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(M4, <span class="fu">aes</span>(<span class="at">x =</span> data60<span class="fl">.22</span><span class="sc">$</span>date, <span class="at">y =</span> norm.port.cum.log.ret)) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cumulative Log Returns (2.2)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span><span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales <span class="sc">::</span> percent) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>))</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>p4 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="quant_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="question-2.3---repeat-1-but-now-each-month-select-the-6-industries-each-allocated-16-of-capital-with-the-highest-return-in-the-past-12-months-computed-as-pit-pit-250---1." class="level3">
<h3 class="anchored" data-anchor-id="question-2.3---repeat-1-but-now-each-month-select-the-6-industries-each-allocated-16-of-capital-with-the-highest-return-in-the-past-12-months-computed-as-pit-pit-250---1.">Question 2.3 - Repeat (1), but now each month select the 6 industries (each allocated 1/6 of capital) with the highest return in the past 12 months (computed as<span class="math inline">\([ P(i;t) / P(i;t-250) ] - 1)\)</span>.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating year.month variable for the 1960-2022 dataset, so that then we can</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># select directly both the year and month at the same time</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>year.mont  <span class="ot">&lt;-</span> <span class="fu">substring</span>(data60<span class="fl">.22</span><span class="sc">$</span>date, <span class="dv">1</span>, <span class="dv">7</span>) </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># New dataframe without the 'day' index in the date variable</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>data.year.mont60<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year.mont =</span> year.mont, </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                                  data60<span class="fl">.22</span>[ , <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregating the daily returns in the new dataframe by month to have cumulative </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># log returns for every month</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>log.data.year.mont60<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year.mont =</span> year.mont, </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">log</span>(data.year.mont60<span class="fl">.22</span>[,<span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span><span class="dv">1</span>) )</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>month.rets <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(log.data.year.mont60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>],  </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">by  =</span> <span class="fu">list</span>(log.data.year.mont60<span class="fl">.22</span><span class="sc">$</span>year.mont), </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">FUN =</span> sum)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(month.rets)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"year.mont"</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>log.month.rets.no.date  <span class="ot">&lt;-</span> month.rets[, <span class="sc">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop to get 12 months rolling window for the best 6 asset classes</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Initializing all the variables we need</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rm(list): object 'list' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>industry <span class="ot">&lt;-</span> <span class="fu">colnames</span>(log.month.rets.no.date) <span class="co"># list of names of every industry</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>n        <span class="ot">&lt;-</span> <span class="fu">nrow</span>(month.rets)                 <span class="co"># dimension for the loop, 745 iterations</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>list     <span class="ot">&lt;-</span> <span class="cn">NULL</span>                             <span class="co"># initializing the variable that will contain all the </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                                <span class="co"># names of the best 6 industries</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">13</span> <span class="sc">:</span> n) ) { <span class="co"># starting from 13 since we start building portfolios from 1961/01</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  yearly.Rets <span class="ot">&lt;-</span> <span class="cn">NULL</span>  <span class="co"># initializing the yearly returns</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  best.Six    <span class="ot">&lt;-</span> <span class="cn">NULL</span>  <span class="co"># initialize the best.six vector that will be erased at every iteration</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> industry) {</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    yearly.Rets[j] <span class="ot">&lt;-</span> <span class="fu">colSums</span>( <span class="fu">as.matrix</span>(log.month.rets.no.date[ ( (i<span class="dv">-12</span>)<span class="sc">:</span>(i<span class="dv">-1</span>) ) , j] )) </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  best.Six <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(yearly.Rets, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]) <span class="co"># best six industries for the previous 12 months</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  list     <span class="ot">&lt;-</span> <span class="fu">rbind</span>(list, best.Six)                            <span class="co"># creating the list with the names of the best industries</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reducing the monthly returns dataset, excluding the first year of data (which</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co"># is lost in the for loop to find the first best six industries)</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregating simple returns to compute avg port rets</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>month.rets2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(data.year.mont60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>],  </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">by  =</span> <span class="fu">list</span>(data.year.mont60<span class="fl">.22</span><span class="sc">$</span>year.mont), </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">FUN =</span> sum)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>new.month.rets <span class="ot">&lt;-</span> month.rets2[ (<span class="dv">13</span><span class="sc">:</span>n), <span class="sc">-</span><span class="dv">1</span> ] </span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop that assigns 1/6 only when the 'industry' is in the 'list', meaning </span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co"># that such industry was one of the best 6 performing in the previous 12 months</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Initializing the weight matrix for the portfolio</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">data.frame</span>() </span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span> <span class="sc">:</span> <span class="fu">nrow</span>(list) ) ) {</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> industry) {</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    w[i,j] <span class="ot">&lt;-</span> ( (<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">*</span> (j <span class="sc">%in%</span> list[i, ]) )</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing portfolio returns with the previously defined weights</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>best.six.port.ret      <span class="ot">&lt;-</span> <span class="fu">rowSums</span>( w <span class="sc">*</span> new.month.rets )</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>best.six.avg.port.ret  <span class="ot">&lt;-</span> <span class="fu">mean</span>(best.six.port.ret)<span class="sc">*</span><span class="dv">12</span>  <span class="co"># time 12 since those are monthly</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>                                                      <span class="co"># returns that we want to annualize</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio standard deviation</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>best.six.std <span class="ot">&lt;-</span> <span class="fu">sd</span>(best.six.port.ret)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">12</span>)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio Sharpe Ratio</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>best.six.sharpe <span class="ot">&lt;-</span> best.six.avg.port.ret  <span class="sc">/</span> best.six.std </span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the cumulative log portfolio returns</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting months to date variables to plot them on the X axis</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>month.rets<span class="sc">$</span>year.mont   <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(month.rets<span class="sc">$</span>year.mont, <span class="st">'01'</span>, <span class="at">sep =</span> <span class="st">'-'</span>) )</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>best6.port.log.ret     <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> best.six.port.ret)  </span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>best6.port.cum.log.ret <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(best6.port.log.ret ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot 6: Cumulative Log returns for the 12 months momentum strategy portfolio </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>y3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(month.rets<span class="sc">$</span>year.mont[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(best6.port.cum.log.ret)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>M5 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x3, y3)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(M5, <span class="fu">aes</span>(<span class="at">x =</span> month.rets<span class="sc">$</span>year.mont[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)], <span class="at">y =</span> best6.port.cum.log.ret)) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cumulative Log Returns (2.3)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span><span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales <span class="sc">::</span> percent) </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>p5 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="quant_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="question-3" class="level2">
<h2 class="anchored" data-anchor-id="question-3">Question 3</h2>
<section id="repeat-the-momentum-strategy-of-question-2.3-but-instead-of-a-constant-full-allocation-of-capital-in-each-period-day-compute-the-covariance-matrix-between-the-6-chosen-industry-in-the-previous-3-months-63-trading-days-and-use-it-to-target-a-constant-portfolio-standard-deviation-of-20-annually." class="level3">
<h3 class="anchored" data-anchor-id="repeat-the-momentum-strategy-of-question-2.3-but-instead-of-a-constant-full-allocation-of-capital-in-each-period-day-compute-the-covariance-matrix-between-the-6-chosen-industry-in-the-previous-3-months-63-trading-days-and-use-it-to-target-a-constant-portfolio-standard-deviation-of-20-annually.">3.3 - Repeat the momentum strategy of Question 2.3, but instead of a constant, full allocation of capital, in each period (day), compute the covariance matrix between the 6 chosen industry in the previous 3 months (63 trading days), and use it to target a constant portfolio standard deviation of 20% annually.</h3>
<div class="cell" data-hash="quant_cache/html/unnamed-chunk-11_a976b5ae726b8d83d82199cca5692247">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we need to find the best 6 asset classes in the previous 3 months </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (63 trading days). We proceed as above, but using daily returns dataset </span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(list2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rm(list2): object 'list2' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>industry2 <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>]) <span class="co"># industry variable as before, with no date</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>n2        <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data60<span class="fl">.22</span>)           <span class="co"># dimension of the for loop</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>list2     <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop that computes the daily list of the 6 best performing portfolios in </span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the 3 months before</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">64</span> <span class="sc">:</span> n2) ) { <span class="co"># from 64 since we start from the first day of the 4th month</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  daily.Rets <span class="ot">&lt;-</span> <span class="cn">NULL</span>    <span class="co"># initialize the daily returns</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  best.Six   <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> industry2) {</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    daily.Rets[j] <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">as.matrix</span>(log.data.<span class="fl">60.22</span>[ (i<span class="dv">-63</span>)<span class="sc">:</span>(i<span class="dv">-1</span>)  , j] )) <span class="co"># USE LOG DATA</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  best.Six <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(daily.Rets, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  list2    <span class="ot">&lt;-</span> <span class="fu">rbind</span>(list2, best.Six)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Covariances computed daily among the 6 best asset classes, on the 3 months </span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co"># rolling window of data before</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>N            <span class="ot">&lt;-</span> <span class="fu">nrow</span>(list2) </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>cov.best.six <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">6</span><span class="sc">*</span><span class="dv">6</span><span class="sc">*</span>N), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">6</span>,N)) <span class="co"># initialize the 3-dimensional array</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N ) {</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  best.six.<span class="fl">3.</span>mont <span class="ot">&lt;-</span> data.year.mont60<span class="fl">.22</span>[ (i<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">62</span>)), <span class="fu">c</span>(list2[i, ])]</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  cov.best.six[ , , i] <span class="ot">&lt;-</span> <span class="fu">cov</span>(best.six.<span class="fl">3.</span>mont)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop that computes daily portfolio weights starting from an equally</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted portfolio, but with weights that are updated every time as defined by</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="co"># the formula [ 0.2/sigma_p_annualized ]</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>weights.star <span class="ot">&lt;-</span> <span class="cn">NULL</span> </span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span>N) ) {      </span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  initial.w <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="dv">6</span>) <span class="co"># initial weights, equally weighted portfolio of 6 assets      </span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  port.std.rebal <span class="ot">&lt;-</span> <span class="fu">sqrt</span>( <span class="fu">t</span>(initial.w ) <span class="sc">%*%</span> cov.best.six[ , , (i)] <span class="sc">%*%</span> initial.w  )</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  weights.star[i]  <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>)<span class="sc">*</span>( <span class="fl">0.2</span> <span class="sc">/</span> (port.std.rebal<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">252</span>) )) </span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Last for loop that computes (as before) the weight matrix for every period. This</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="co"># time weights are not constant and are extracted from the previous loop. A weight</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="co"># different from zero is assigned only for those days and those industries that</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="co"># were in the best 6 performing ones</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>weights.star.matrix <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span> <span class="sc">:</span> N ) ) {</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> industry) {</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    weights.star.matrix[i,j] <span class="ot">&lt;-</span> ( weights.star[i] <span class="sc">*</span> (j <span class="sc">%in%</span> list2[i, ]) )</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio returns</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>data60.<span class="fl">22.</span>cut     <span class="ot">&lt;-</span> data60<span class="fl">.22</span>[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">63</span>), <span class="sc">-</span><span class="dv">1</span> ] <span class="co"># removing the first 3 months</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>port.ret.star     <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(weights.star.matrix <span class="sc">*</span> data60.<span class="fl">22.</span>cut)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>avg.port.ret.star <span class="ot">&lt;-</span> <span class="fu">mean</span>(port.ret.star) <span class="sc">*</span> <span class="dv">252</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio standard deviation</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>port.ret.star.std <span class="ot">&lt;-</span> <span class="fu">sd</span>(port.ret.star)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">252</span>) </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio Sharpe Ratio</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>Sharpe.star <span class="ot">&lt;-</span> avg.port.ret.star <span class="sc">/</span> port.ret.star.std</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting portfolio cumulative log returns</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>port.log.ret.star     <span class="ot">&lt;-</span> <span class="fu">log</span>(port.ret.star <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>port.cum.log.ret.star <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(port.log.ret.star)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot 7: Cumulative Log returns of the 3 months momentum strategy portfolio, </span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># with a target volatility of 20% per annum</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>x4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data60<span class="fl">.22</span><span class="sc">$</span>date[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">63</span>)])</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>y4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(port.cum.log.ret.star)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>M6 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x4, y4)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(M6, <span class="fu">aes</span>(<span class="at">x =</span> data60<span class="fl">.22</span><span class="sc">$</span>date[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">63</span>)], <span class="at">y =</span> port.cum.log.ret.star)) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cumulative Log Returns (3)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span><span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales <span class="sc">::</span> percent)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>p6 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="quant_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="question-4" class="level2">
<h2 class="anchored" data-anchor-id="question-4">Question 4</h2>
<section id="compute-the-equal-weighted-portfolio-as-in-question-2.1-on-the-1960-2022-sample-and-the-yearly-return-in-each-industry-as-in-question-2.3.-in-each-period-each-day-compute-the-share-alpha_t-of-industries-with-positive-momentum-positive-yearly-return-and-invest-in-the-equal-weighted-portfolio-each-month-a-share-alpha_t-with-the-rest-going-to-cash-which-you-should-assume-yields-3-annually" class="level3">
<h3 class="anchored" data-anchor-id="compute-the-equal-weighted-portfolio-as-in-question-2.1-on-the-1960-2022-sample-and-the-yearly-return-in-each-industry-as-in-question-2.3.-in-each-period-each-day-compute-the-share-alpha_t-of-industries-with-positive-momentum-positive-yearly-return-and-invest-in-the-equal-weighted-portfolio-each-month-a-share-alpha_t-with-the-rest-going-to-cash-which-you-should-assume-yields-3-annually">4.1 - Compute the equal-weighted portfolio as in Question 2.1 (on the 1960-2022 sample) and the yearly return in each industry as in Question 2.3. In each period (each day), compute the share alpha_t of industries with positive momentum (positive yearly return), and invest in the equal-weighted portfolio each month a share alpha_t, with the rest going to cash, which you should assume yields 3% annually</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>n.<span class="fl">60.22</span> <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data60<span class="fl">.22</span>) </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining a new empty matrix to be filled in the loop, that will contain all the </span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># yearly returns computed on a daily basis</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>new.yearly.Rets <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol =</span> <span class="dv">17</span>, <span class="at">nrow =</span> (n.<span class="fl">60.22</span><span class="sc">-</span> <span class="dv">252</span> ) )</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">253</span><span class="sc">:</span>n.<span class="fl">60.22</span>) ) {</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>   new.yearly.Rets[(i<span class="dv">-252</span>), ] <span class="ot">&lt;-</span> <span class="fu">colSums</span>( data60<span class="fl">.22</span>[  (i<span class="dv">-252</span>)<span class="sc">:</span>(i<span class="dv">-1</span>) , <span class="sc">-</span><span class="dv">1</span> ] )</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing the column names of the matrix with yearly (daily) returns</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(new.yearly.Rets) <span class="ot">&lt;-</span> industry</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing number of industries that have a positive yearly return in every period (day)</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>positive.yearly.rets  <span class="ot">&lt;-</span> (new.yearly.Rets <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">*</span> <span class="dv">1</span>  <span class="co"># 1s and 0s if the condition is met in every cell</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Column vector containing the number of industries for every period that had a</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co"># previous yearly return &gt; 0</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>number.pos.industries <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(positive.yearly.rets))</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the share we invest in the portfolio and the share we invest in the </span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co"># risk free rate for every period </span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>alpha.portfolio <span class="ot">&lt;-</span> number.pos.industries <span class="sc">/</span> <span class="dv">17</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>alpha.rf        <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> alpha.portfolio</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a vector of risk free rate daily returns</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>rf_rets <span class="ot">&lt;-</span> <span class="fu">rep</span>( (<span class="fl">0.03</span><span class="sc">/</span><span class="dv">252</span>), <span class="fu">nrow</span>(alpha.rf) ) </span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating an equally weighted portfolio that invests in all assets from 1960 to</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 2022</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>bal.port.weights     <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">17</span>,<span class="dv">17</span>)</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>bal.portfolio.rets<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(bal.port.weights <span class="sc">*</span> data60<span class="fl">.22</span>[ (<span class="dv">253</span><span class="sc">:</span>n.<span class="fl">60.22</span>), <span class="sc">-</span><span class="dv">1</span>]) </span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Final vector of portfolio returns, with alpha in the assets and (1-alpha) in rf</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>portfolio_rets_final <span class="ot">&lt;-</span> (alpha.portfolio <span class="sc">*</span> bal.portfolio.rets<span class="fl">.4</span>  <span class="sc">+</span> alpha.rf <span class="sc">*</span> rf_rets)</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>excess_rets          <span class="ot">&lt;-</span> portfolio_rets_final <span class="sc">-</span> (<span class="fl">0.03</span><span class="sc">/</span><span class="dv">252</span>) </span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>mean_excess_rets     <span class="ot">&lt;-</span> <span class="fu">mean</span>(excess_rets)<span class="sc">*</span><span class="dv">252</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio Standard deviation </span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>excess_rets_std  <span class="ot">&lt;-</span> <span class="fu">sd</span>(excess_rets)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">252</span>)</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>Sharpe_ratio_final <span class="ot">&lt;-</span> mean_excess_rets <span class="sc">/</span> excess_rets_std </span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Cheching for correlation among industries</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(data60<span class="fl">.22</span>[, <span class="sc">-</span><span class="dv">1</span>]) <span class="co"># They are all positively correlated</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  food     mines       oil   clothes  durables chemicals
food         1.0000000 0.4221401 0.5635021 0.6372003 0.6668227 0.6818481
mines        0.4221401 1.0000000 0.6027994 0.4952207 0.5062316 0.6181290
oil          0.5635021 0.6027994 1.0000000 0.5442680 0.5618443 0.6903127
clothes      0.6372003 0.4952207 0.5442680 1.0000000 0.7418931 0.7075379
durables     0.6668227 0.5062316 0.5618443 0.7418931 1.0000000 0.7371643
chemicals    0.6818481 0.6181290 0.6903127 0.7075379 0.7371643 1.0000000
consumables  0.7851581 0.4061970 0.5433978 0.6017780 0.6762898 0.6625151
construction 0.6901560 0.5448562 0.5982225 0.7858976 0.7717992 0.7626440
steel        0.5423509 0.6874389 0.6536077 0.6596458 0.6644166 0.7670215
fabricated   0.6526977 0.5799275 0.6269678 0.7443878 0.7470930 0.7807940
machinery    0.5933947 0.5282759 0.5550709 0.6855738 0.7480683 0.6985862
cars         0.5876973 0.4788203 0.5273881 0.6699730 0.7123470 0.6906050
transport    0.6985269 0.5542982 0.6423833 0.7605967 0.7823973 0.8002957
utilities    0.6671723 0.4621931 0.6120628 0.5619578 0.5592346 0.6185207
retail       0.7152233 0.4379905 0.5158985 0.7478446 0.7419169 0.6901858
finance      0.6738145 0.5283206 0.6144143 0.7472040 0.7392522 0.7489268
others       0.7061397 0.5444107 0.6054952 0.7608868 0.7904640 0.7517579
             consumables construction     steel fabricated machinery      cars
food           0.7851581    0.6901560 0.5423509  0.6526977 0.5933947 0.5876973
mines          0.4061970    0.5448562 0.6874389  0.5799275 0.5282759 0.4788203
oil            0.5433978    0.5982225 0.6536077  0.6269678 0.5550709 0.5273881
clothes        0.6017780    0.7858976 0.6596458  0.7443878 0.6855738 0.6699730
durables       0.6762898    0.7717992 0.6644166  0.7470930 0.7480683 0.7123470
chemicals      0.6625151    0.7626440 0.7670215  0.7807940 0.6985862 0.6906050
consumables    1.0000000    0.6653683 0.5208705  0.6286297 0.6258095 0.5712887
construction   0.6653683    1.0000000 0.6990675  0.7780020 0.7207812 0.7065914
steel          0.5208705    0.6990675 1.0000000  0.7393210 0.7079244 0.6399191
fabricated     0.6286297    0.7780020 0.7393210  1.0000000 0.7192180 0.6782067
machinery      0.6258095    0.7207812 0.7079244  0.7192180 1.0000000 0.6780107
cars           0.5712887    0.7065914 0.6399191  0.6782067 0.6780107 1.0000000
transport      0.6858305    0.7993345 0.7326697  0.8056136 0.7503247 0.7203940
utilities      0.6088031    0.6093170 0.5355988  0.6182085 0.5155898 0.5083854
retail         0.7167139    0.7950867 0.5920443  0.6912343 0.7061698 0.6765263
finance        0.6670276    0.7977089 0.6996558  0.7543433 0.7109848 0.6814829
others         0.7305838    0.8002420 0.7256041  0.7747935 0.8726412 0.7245589
             transport utilities    retail   finance    others
food         0.6985269 0.6671723 0.7152233 0.6738145 0.7061397
mines        0.5542982 0.4621931 0.4379905 0.5283206 0.5444107
oil          0.6423833 0.6120628 0.5158985 0.6144143 0.6054952
clothes      0.7605967 0.5619578 0.7478446 0.7472040 0.7608868
durables     0.7823973 0.5592346 0.7419169 0.7392522 0.7904640
chemicals    0.8002957 0.6185207 0.6901858 0.7489268 0.7517579
consumables  0.6858305 0.6088031 0.7167139 0.6670276 0.7305838
construction 0.7993345 0.6093170 0.7950867 0.7977089 0.8002420
steel        0.7326697 0.5355988 0.5920443 0.6996558 0.7256041
fabricated   0.8056136 0.6182085 0.6912343 0.7543433 0.7747935
machinery    0.7503247 0.5155898 0.7061698 0.7109848 0.8726412
cars         0.7203940 0.5083854 0.6765263 0.6814829 0.7245589
transport    1.0000000 0.6205587 0.7419667 0.7895643 0.8075617
utilities    0.6205587 1.0000000 0.5586017 0.6232721 0.6268410
retail       0.7419667 0.5586017 1.0000000 0.7223783 0.8001743
finance      0.7895643 0.6232721 0.7223783 1.0000000 0.8034126
others       0.8075617 0.6268410 0.8001743 0.8034126 1.0000000</code></pre>
</div>
</div>
<div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot 8: Cumulative Log returns for the portfolio with alpha wealth invested</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in an EW portfolio in the industries and (1-alpha) weight in a Risk Free rate</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># asset that yields 3% per annum</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>port.cum.log.exc.ret <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">log</span>(excess_rets <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>x5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data60<span class="fl">.22</span><span class="sc">$</span>date[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">252</span>)])</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>y5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(port.cum.log.exc.ret)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>M7 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x5, y5)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(M7, <span class="fu">aes</span>(<span class="at">x =</span> data60<span class="fl">.22</span><span class="sc">$</span>date[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">252</span>)], <span class="at">y =</span> port.cum.log.exc.ret)) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cumulative Log Returns (4)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span><span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales <span class="sc">::</span> percent)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>p7 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>)) </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="do">### plot 9: Daily allocation in the EW portfolio of industries</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>x8 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data60<span class="fl">.22</span><span class="sc">$</span>date[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">252</span>)])</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>y8 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(alpha.portfolio)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>M8 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x8, y8)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>p10 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(M8, <span class="fu">aes</span>(<span class="at">x =</span> data60<span class="fl">.22</span><span class="sc">$</span>date[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">252</span>)], <span class="at">y =</span> alpha.portfolio)) <span class="sc">+</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Asset Portfolio Allocation (4)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span><span class="st">"Allocation"</span>) <span class="sc">+</span> </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales <span class="sc">::</span> percent)</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>p10 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="quant_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="quant_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="question-5" class="level2">
<h2 class="anchored" data-anchor-id="question-5">Question 5</h2>
<section id="for-the-full-sample-repeat-the-momentum-strategy-in-question-2.3-but-use-the-returns-of-the-previous-five-years-252-5-days-as-a-measure-of-momentum.-briefly-comment-on-the-results." class="level3">
<h3 class="anchored" data-anchor-id="for-the-full-sample-repeat-the-momentum-strategy-in-question-2.3-but-use-the-returns-of-the-previous-five-years-252-5-days-as-a-measure-of-momentum.-briefly-comment-on-the-results.">5.1 - For the full sample, repeat the momentum strategy in Question 2.3, but use the returns of the previous five years (252 * 5 days) as a measure of momentum. Briefly comment on the results.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Full log dataset to aggregate</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>log.data.no.date <span class="ot">&lt;-</span> <span class="fu">log</span>(data[, <span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> <span class="dv">1</span>) </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>year.mont.full   <span class="ot">&lt;-</span> <span class="fu">substring</span>(data<span class="sc">$</span>date, <span class="dv">1</span>, <span class="dv">7</span>) </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># New dataframe without the 'day' index in the date variable</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>log.data.year.mont.full <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year.mont.full =</span> year.mont.full, </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                                      log.data.no.date) </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregating the daily returns by month </span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>log.month.rets.full <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(log.data.year.mont.full[, <span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="fu">list</span>(log.data.year.mont.full<span class="sc">$</span>year.mont.full), </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">FUN =</span> sum)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the dataset with monthly simple returns</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>data.year.mont.full <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year.mont.full =</span> year.mont.full, data[, <span class="sc">-</span><span class="dv">1</span>] )</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>month.rets.full     <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(data.year.mont.full[, <span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="fu">list</span>(data.year.mont.full<span class="sc">$</span>year.mont.full), </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>                             <span class="at">FUN =</span> sum)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop to get 5 years rolling window for the best 6 asset classes</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Initializing all the variables we need</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(list3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rm(list3): object 'list3' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>industry3        <span class="ot">&lt;-</span> <span class="fu">colnames</span>(log.month.rets.full[<span class="sc">-</span><span class="dv">1</span>]) </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>yearly.Rets.full <span class="ot">&lt;-</span> <span class="cn">NULL</span>                           </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>n.full           <span class="ot">&lt;-</span> <span class="fu">nrow</span>(log.month.rets.full)           </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>list3            <span class="ot">&lt;-</span> <span class="cn">NULL</span>                            </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 60 MONTHS = 5 YEARS</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">61</span> <span class="sc">:</span> n.full) ) { <span class="co"># starting from 61 since we start building portfolios from 5 years after 1926</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  best.Six <span class="ot">=</span> <span class="cn">NULL</span>           <span class="co"># initialize the best.six vector that will be erased at every iteration</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> industry) {</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    yearly.Rets.full[j] <span class="ot">&lt;-</span> <span class="fu">sum</span>( log.month.rets.full[ ( (i<span class="dv">-60</span>)<span class="sc">:</span>(i<span class="dv">-1</span>) ) , j] ) <span class="co"># cumulating monthly rets into 5-years rets</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  best.Six <span class="ot">&lt;-</span> <span class="fu">names</span>( <span class="fu">sort</span>(yearly.Rets.full, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]) <span class="co"># best six industries for the previous 12 months</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  list3    <span class="ot">&lt;-</span> <span class="fu">rbind</span>(list3, best.Six)                            <span class="co"># creating the list with the names of the best industries</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Initializing the weight matrix for the portfolio</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>w.full <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># For loop that assigns 1/6 only when the 'industry' is inside 'list3', meaning </span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># that such industry was one of the best 6 performing in the previous 12*5 = 60 months</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span> <span class="sc">:</span> <span class="fu">nrow</span>(list3) ) ) {</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> industry) {</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    w.full[i,j] <span class="ot">&lt;-</span> ( (<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">*</span> (j <span class="sc">%in%</span> list3[i, ]) )</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio returns with the previously defined weights</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>best.six.port.ret.full      <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(w.full <span class="sc">*</span> month.rets.full[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>), <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>best.six.avg.port.ret.full  <span class="ot">&lt;-</span> <span class="fu">mean</span>(best.six.port.ret.full) <span class="sc">*</span> <span class="dv">12</span> </span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio standard deviation</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>best.six.std.full <span class="ot">&lt;-</span> <span class="fu">sd</span>(best.six.port.ret.full)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">12</span>)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio Sharpe Ratio</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>best.six.sharpe.full <span class="ot">&lt;-</span> best.six.avg.port.ret.full  <span class="sc">/</span> best.six.std.full</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting cumulative portfolio returns</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(month.rets.full)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"year.mont"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>month.rets.full<span class="sc">$</span>year.mont    <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(month.rets.full<span class="sc">$</span>year.mont, <span class="st">'01'</span>, <span class="at">sep =</span> <span class="st">'-'</span>) )</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>port.log.ret.full     <span class="ot">&lt;-</span> <span class="fu">log</span>(best.six.port.ret.full  <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>port.cum.log.ret.full <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(port.log.ret.full)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot 8: Cumulative Log Returns for the 5-years momentum strategy portfolio </span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>x6 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(month.rets.full<span class="sc">$</span>year.mont[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>)])</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>y6 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(port.cum.log.ret.full)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>M8 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x6, y6)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(M8, <span class="fu">aes</span>(<span class="at">x =</span> month.rets.full<span class="sc">$</span>year.mont[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">60</span>)], <span class="at">y =</span> port.cum.log.ret.full)) <span class="sc">+</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cumulative Log Returns (5)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span><span class="st">"Log Returns"</span>) <span class="sc">+</span> </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales <span class="sc">::</span> percent)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>p8 <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="quant_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>